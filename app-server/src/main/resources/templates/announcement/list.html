<!DOCTYPE html>
<html>
<head>
    <style>
        .horizontal-pagination .page-item {
            display: inline-block;
        }

        .horizontal-pagination .page-link {
            padding: 8px 12px;
            margin: 0 4px;
        }
    </style>

    <meta charset='UTF-8'>
    <title>BitGallery</title>
</head>
<body>

<div data-th-replace="header :: header"></div>

<h1>공지사항</h1>

<div style='margin:5px;'>
<a style="text-decoration-line: none;"
   data-th-if="${#strings.equals(authority, 'ADMIN')}"
   data-th-href="@{/announcement/form(currentPage=${currentPage})}">새 글</a>
</div>

<table border='1'>
<thead>
  <tr>
      <th>번호</th>
      <th>제목</th>
      <th>작성자</th>
      <th>등록일</th>
  </tr>
</thead>

<tbody>
    <tr data-th-each="announcement : ${list}">
      <td data-th-text="${announcement.no}">100</td>
        <td>
            <a style="text-decoration-line: none;" data-th-href="@{/announcement/detail(no=${announcement.no},currentPage=${currentPage})}"
               data-th-text="${announcement.title} ?: '제목없음'">게시글 제목</a>
        </td>
      <td data-th-text="${announcement.writer.name}">홍길동</td>
      <td data-th-text="${#dates.format(announcement.createdDate, 'yyyy-MM-dd')}">2021-09-14</td>
    </tr>

</tbody>

</table>
<a style="text-decoration-line: none;" data-th-href='@{/}'>메인</a>

<nav aria-label="Page navigation">
    <ul id="pagination" class="pagination horizontal-pagination">
        <!-- 페이지 번호 추가 -->
        <script>
            // 전체 페이지 수와 현재 페이지를 서버에서 받아와야 합니다.
            const totalPages = parseInt([[${size}]]);
            const currentPage = parseInt([[${currentPage}]]);
            const pageSize = parseInt([[${pageSize}]]);
            const row = parseInt(10);
            const actualSize = totalPages % pageSize == 0 ? parseInt(totalPages / pageSize) : parseInt(totalPages / pageSize) + 1;

            const startPage = currentPage % row == 0 ? (parseInt(((currentPage-1) / row)) *row) + 1 : (parseInt((currentPage / row)) * row) + 1;
            const endPage = startPage - 1 + Math.min(row, actualSize - startPage + 1);
            const paginationElement = document.getElementById("pagination");

            console.log("currentPage=  "+ currentPage);
            console.log("startPage=  " + startPage);
            console.log("endPage=  " + endPage);
            console.log("actualSize=  " + actualSize);
            console.log("totalPages=  " + totalPages);

            if (currentPage === 1) {
                paginationElement.innerHTML += `
                    <li class="page-item disabled" style="visibility: hidden;"><a class="page-link" href="/announcement/list?currentPage=1">Previous</a></li>`;
            } else {
                 paginationElement.innerHTML += `
                    <li class="page-item active"><a class="page-link" href="/announcement/list?currentPage=${currentPage - 1}">Previous</a></li>`;
            }

            // 페이지 번호 추가
            for (let page = startPage; page <= endPage; page++) {
                const pageItemClass = page === currentPage ? 'current-page' : '';
                const pageStyle = page === currentPage ? 'font-weight: bold; color: blue;' : '';

                // 현재 페이지에 해당하는 <li> 요소에 스타일을 추가하고 라인 번호를 표시합니다.
                const pageLink = `
                    <li class="page-item ${pageItemClass}" style="display: inline-block;">
                        <a class="page-link" href="/announcement/list?currentPage=${page}" style="${pageStyle}">${page}</a>
                    </li>
                `;

                paginationElement.innerHTML += pageLink;
            }

            if (currentPage >= actualSize) {
                paginationElement.innerHTML += `
                    <li class="page-item disabled" style="visibility: hidden;"><a class="page-link" href="/announcement/list?currentPage=${actualSize}">Next</a></li>`;
            } else {
                 paginationElement.innerHTML += `
                    <li class="page-item active"><a class="page-link" href="/announcement/list?currentPage=${currentPage + 1}">Next</a></li>`;
            }
        </script>

    </ul>
</nav>

    <div data-th-replace="footer :: footer"></div>

</body>
</html>